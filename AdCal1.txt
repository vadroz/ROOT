<%@ page import="advertising.AdCal,advertising.AdCalSel, java.util.*"%>
<%
   String sMonBeg = request.getParameter("MonBeg");
   String sMonName = request.getParameter("MonName");
   // promotion filter paramters
   String sFilterPromo = request.getParameter("FilterPromo");
   String sFilterAdType = request.getParameter("FilterAdType");
   String sFilterAdTypeDes = request.getParameter("FilterAdTypeDes");
   String sFilterAdName = request.getParameter("FilterAdName");
   // media filter parameter
   String sFilterMedia = request.getParameter("FilterMedia");
   String sFilterMedCode = request.getParameter("FilterMedCode");
   String sFilterMedIdx = request.getParameter("FilterMedIdx");
   String sFilterMedName = request.getParameter("FilterMedName");

   if(sFilterPromo==null) sFilterPromo="false";
   if(sFilterMedia==null) sFilterMedia="false";

   int iNumOfMkt = 0;
   String [] sMkt = null;
   String [] sMktName = null;
   int [] iNumOfStr = null;
   String sMktJsa = null;
   String sMktNameJsa = null;
   String sStrJsa = null;

   int iNumOfWk = 0;
   String [] sWkend = null;
   String sWkendJsa = null;

   String [] sPrvNxtMonth = null;
   String [] sPrvNxtMonName = null;

   String sMediaJsa = null;
   String sMedNameJsa = null;

   String sPromoJsa = null;
   String sEventJsa = null;
   String sNonEvtJsa = null;
   String sMedComJsa = null;


   //  market total
    String [][] sMTPlnCost = null;
    String [][] sMTActCost = null;
    String [][] sMTFinCost = null;
    String [][] sMTPlanPrc = null;
    String [][] sMTPlan = null;
    // report total
    String [] sRTPlnCost = null;
    String [] sRTActCost = null;
    String [] sRTFinCost = null;
    String [] sRTPlanPrc = null;
    String [] sRTPlan = null;


    //weekly plan total
    String [] sWkPlan = null;

   //----------------------------------
   // Application Authorization
   //----------------------------------

   if (session.getAttribute("USER")==null || session.getAttribute("ADVERTISES")==null)
   {
     response.sendRedirect("SignOn1.jsp?TARGET=AdCal.jsp&APPL=ADVERTISES&" + request.getQueryString());
   }
   else
   {

     // Get Month list
     AdCalSel adCalSel = new AdCalSel();

     String sMonBegJsa = adCalSel.getMonBegJsa();
     String sMonNameJsa = adCalSel.getMonNameJsa();
     String sYearJsa = adCalSel.getYearJsa();
     String sCurMon = adCalSel.getCurMon();

     adCalSel.disconnect();


     AdCal adCal = new AdCal(sMonBeg);

     iNumOfMkt = adCal.getNumOfMkt();
     sMkt = adCal.getMkt();
     sMktName = adCal.getMktName();
     iNumOfStr = adCal.getNumOfStr();
     sMktJsa = adCal.getMktJsa();
     sMktNameJsa = adCal.getMktNameJsa();
     sStrJsa = adCal.getStr();

     iNumOfWk = adCal.getNumOfWk();
     sWkend = adCal.getWkend();
     sWkendJsa = adCal.getWkendJsa();

     sPrvNxtMonth = adCal.getPrvNxtMonth();
     sPrvNxtMonName = adCal.getPrvNxtMonName();

     sMediaJsa = adCal.getMediaJsa();
     sMedNameJsa = adCal.getMedNameJsa();

     sPromoJsa = adCal.getPromoJsa();
     sEventJsa = adCal.getEventJsa();
     sNonEvtJsa = adCal.getNonEvtJsa();
     sMedComJsa = adCal.getMedComJsa();

     //  market total
     sMTPlnCost = adCal.getMTPlnCost();
     sMTActCost = adCal.getMTActCost();
     sMTFinCost = adCal.getMTFinCost();
     sMTPlanPrc = adCal.getMTPlanPrc();
     sMTPlan = adCal.getMTPlan();
     // report total
     sRTPlnCost = adCal.getRTPlnCost();
     sRTActCost = adCal.getRTActCost();
     sRTFinCost = adCal.getRTFinCost();
     sRTPlanPrc = adCal.getRTPlanPrc();
     sRTPlan = adCal.getRTPlan();

     //weekly plan total
     sWkPlan = adCal.getWkPlan();

%>
<html>
<head>
<style>
        body {background:ivory;}
        a { color:blue} a:visited { color:blue}  a:hover { color:blue}

        table.DataTable { border: darkred solid 1px; background:#FFE4C4;text-align:center;}
        th.DataTable { background:#FFCC99; padding-top:3px; padding-bottom:3px;
                       padding-left:3px; padding-right:3px;
                       border-bottom: darkred solid 1px;border-right: darkred solid 1px;text-align:center;
                       font-family:Verdanda; font-size:12px }
        th.DataTable1 { background:#FFCC99; padding-top:3px; padding-bottom:3px;
                       border-bottom: darkred solid 1px;border-right: darkred solid 1px;text-align:center;
                       font-family:Verdanda; font-size:12px }
        th.DataTable2 { background:#FFCC99; padding-top:3px; padding-bottom:3px;
                       padding-left:3px; padding-right:3px;
                       border-bottom: darkred solid 1px;border-right: darkred solid 1px;text-align:right;
                       font-family:Verdanda; font-size:12px }
        th.DataTable3 { background:#FFCC99; padding-top:3px; padding-bottom:3px;
                       padding-left:3px; padding-right:3px;
                       border-bottom: darkred solid 1px; text-align:center; font-family:Verdanda; font-size:12px }

        td.DataTable { background:cornsilk; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                       padding-top:3px; padding-bottom:3px; padding-right:3px; padding-left:3px;
                       text-align:left; font-family:Arial; font-size:10px }
        td.DataTable1 { background:lightgrey; cursor: hand; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                        padding-top:3px; padding-bottom:3px; padding-left:3px; padding-right:3px;
                        border-right: darkred solid 1px; text-align:left; font-family:Arial;font-size:10px }
        td.DataTable2 { background:seashell; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                        padding-top:3px; padding-bottom:3px; padding-left:20px; padding-right:3px; border-right: darkred solid 1px; text-align:left;
                        font-family:Arial; font-size:10px }
        td.DataTable2a { background:seashell; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                        padding-top:3px; padding-bottom:3px; padding-left:3px; padding-right:3px;
                        border-right: darkred solid 1px; text-align:right; font-family:Arial; font-size:10px }


        td.DataTable3  { background:lightgrey; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                        padding-top:3px; padding-bottom:3px; padding-right:3px; padding-left:3px;
                        border-right: darkred solid 1px; text-align:right; font-family:Arial;font-size:10px }
        td.DataTable3a { background:lightgrey; cursor: hand; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                       padding-top:3px; padding-bottom:3px; padding-left:40px; padding-right:3px; border-right: darkred solid 1px;
                       text-align:left; font-family:Arial; font-size:10px }

        td.DataTable4 { background:cornsilk; cursor: hand; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                        padding-top:3px; padding-bottom:3px; padding-right:3px; padding-left:3px;
                        border-right: darkred solid 1px; text-align:right; font-family:Arial; font-size:10px }
        td.DataTable5 { background:cornsilk; border-top: darkred solid 1px; border-bottom: darkred solid 1px;
                       padding-top:3px; padding-bottom:3px; border-right: darkred solid 1px; text-align:right; font-family:Arial; font-size:10px }

        div.Menu { position:absolute; visibility:hidden; background-attachment: scroll;
              border: black solid 2px; width:150px; background-color:#EEEEEE; z-index:1;
              text-align:center; font-size:10px}
        td.Menu   {border-bottom: black solid 1px; cursor: hand; text-align:left; font-family:Arial; font-size:10px; }
        td.Menu1  {color:blue;border-bottom: black solid 1px; text-align:center; font-family:Arial; font-size:11px; font-weight:bold}
        td.Menu2  {border-bottom: black solid 1px; text-align:right; font-family:Arial; font-size:12px; }

        div.Promo { position:absolute; visibility:hidden; background-attachment: scroll;
              border: black solid 2px; width:900; background-color:LemonChiffon; z-index:10;
              text-align:center; font-size:10px}
        tr.Promo  {background-color: blue; color:white; text-align:center; font-family:Arial;
                   font-size:12px; font-weight:bold}
        td.Promo  {border-bottom: black solid 1px; text-align:center; font-family:Arial; font-size:10px;
                   padding-top:3px; padding-bottom:3px;}
        td.Promo1 {border-bottom: black solid 1px; border-right: black solid 1px; border-top: black solid 1px;
                   text-align:center; font-family:Arial; font-size:10px; }
        .small{ text-align:left; font-family:Arial; font-size:10px;}

        div.Filter { background-attachment: scroll;
              border: black solid 2px; width:250; background-color:lightgrey; z-index:10;
              text-align:center; font-size:10px}
        tr.Filter { text-align:left; font-family:Arial; font-size:10px;
                   padding-top:3px; padding-bottom:3px;}
        tr.Filter1 { text-align:center; font-family:Arial; font-size:12px;
                   font-weight:bold}
        div.Month {  background-color:cornsilk; background-attachment: scroll; border: black solid 2px; width:250;
                    padding-top:3px; padding-bottom:3px; z-index: 1; text-align:center; font-size:10px}

</style>
<SCRIPT language="JavaScript1.2">
//------------------------------------------------------------------------------
// global variables
//------------------------------------------------------------------------------
  var Wkend = [<%=sWkendJsa%>];
  var Market = [<%=sMktJsa%>];
  var MktName = [<%=sMktNameJsa%>];
  var Store = [<%=sStrJsa%>];
  var Media = [<%=sMediaJsa%>];
  var MedName = [<%=sMedNameJsa%>];
  var Promo  = [<%=sPromoJsa%>];
  var Event  = [<%=sEventJsa%>];
  var NonEvt = [<%=sNonEvtJsa%>];
  var MedCom = [<%=sMedComJsa%>];

  var MonBegs = [<%=sMonBegJsa%>];
  var MonName = [<%=sMonNameJsa%>];
  var Year = [<%=sYearJsa%>];
  var CurMon = <%=sCurMon%>;
  //------------------------------------------------------------------------------
  // save selected values
  var SelMedia = null;
  var SelAdType = null;
  var SelAdTypeDes = null;
  var SelAdName = null;
  var SelSeq = null;
  var SelPayee = null;
  var SelComment = null;
  var SelSize = null;
  var SelWDay = null;
  var SelRate = null;
  var SelSect = null;
  var SelSpot = null;
  var SelFrDate = null;
  var SelToDate = null;
  var SelStr = null;
  var SelNumWk = null;
  var SelTotPlnCost = null;
  var SelTotActCost = null;
  var SelTotFinCost = null;
  var SelMkt = null;
  var SelWk = null;
  var SelOrgWk = null;
  var SelObj = null;
  var SelAction = null;
  var SelLevel = null;
  var SelMonWk = false;

  // promotion filter variables
  var FilterPromo = <%=sFilterPromo%>;
  var FilterAdType = null;
  var FilterAdTypeDes = null;
  var FilterAdName = null;
  if (FilterPromo) {  FilterAdType = '<%=sFilterAdType%>'; FilterAdTypeDes = '<%=sFilterAdTypeDes%>'; FilterAdName = '<%=sFilterAdName%>';  }


  // media filter variables
  var FilterMedia = <%=sFilterMedia%>;
  var FilterMedCode = null;
  var FilterMedIdx = null;
  var FilterMedName = null;
  if (FilterMedia) { FilterMedCode = '<%=sFilterMedCode%>'; FilterMedIdx = '<%=sFilterMedIdx%>'; FilterMedName = '<%=sFilterMedName%>'; }
  var DtlMktLvl = true;
  var DtlGrpLvl = true;
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// body load
//------------------------------------------------------------------------------
function bodyLoad()
{
   dspGrpDtl()
   dspMktDtl()
   dspPromoFilter();
   dspMediaFilter();
   setMonth();
}

//==============================================================================
// display Filter for promotion selection
//==============================================================================
function dspPromoFilter()
{
   var html = "<table>"
     + "<tr class='Filter1'><th colspan='2'>Promotion Filter&nbsp;&nbsp;&nbsp;&nbsp;"
     + "<span id='spfStatus' style='color:red; font-style: italic; '></span>"
     + "</th></tr>"
       + "<tr class='Filter'><td>Promotion:</td>"
       + "<td><select name='sfAdType' class='small' onchange='showFilterAdList()'></select></td></tr>"
     + "<tr class='Filter'><td >&nbsp;</td>"
       + "<td ><select name='sfAdList' class='small'></select></td></tr>"
     + "<tr class='Filter'><td >&nbsp;</td>"
       + "<td><button id='btnSetFilter' class='small' onclick='activatePromoFilter();'>Set</button></td></tr>"
     + "</table>"


   document.all.dvFilterPromo.innerHTML=html
   document.all.dvFilterPromo.style.pixelLeft=10
   document.all.dvFilterPromo.style.pixelTop=15
   setPromoFilter();
}

//==============================================================================
// Setup Ad type list
//==============================================================================
function setPromoFilter()
{
  var i = 0;
  document.all.sfAdType.options[i++] = new Option( "-- Select later -- ", "A");
  if(Promo.length > 0) document.all.sfAdType.options[i++] = new Option( "Promotion", "P");
  if(Event.length > 0) document.all.sfAdType.options[i++] = new Option( "Event", "E");
  if(NonEvt.length > 0) document.all.sfAdType.options[i++] = new Option("Non-Event", "N" );
  if(MedCom.length > 0) document.all.sfAdType.options[i++] = new Option("Media Commitments", "M" );
  document.all.sfAdType.options[i++] = new Option( "None", "X");
  if(FilterPromo)
  {
    for(var j=0; j < i; j++)
    {
      if(document.all.sfAdType.options[j].value==FilterAdType)
      {
       document.all.sfAdType.selectedIndex=j;
       break;
      }
    }
  }
  showFilterAdList();
}

//==============================================================================
// Setup Adv List drop-menu
//==============================================================================
function showFilterAdList()
{
  var adType = document.all.sfAdType[document.all.sfAdType.selectedIndex].value;
  var numOnList = document.all.sfAdList.length;

  for (var i = numOnList; i > 0; i--)  { document.all.sfAdList.options[i]=null; }

  if(adType=="P") { for (var i = 0; i < Promo.length; i++) { document.all.sfAdList.options[i] = new Option(Promo[i], Promo[i]); } }
  else if(adType=="E")  { for (var i = 0; i < Event.length; i++) { document.all.sfAdList.options[i] = new Option(Event[i], Event[i]); } }
  else if(adType=="N")  { for (var i = 0; i < NonEvt.length; i++) { document.all.sfAdList.options[i] = new Option(NonEvt[i], NonEvt[i]); } }
  else if(adType=="M")  { for (var i = 0; i < MedCom.length; i++) { document.all.sfAdList.options[i] = new Option(MedCom[i], MedCom[i]); } }
  else if(adType=="X")  { document.all.sfAdList.options[i++] = new Option("None", "NONE" ); }
  else if(adType=="A")  { document.all.sfAdList.options[i] = new Option("-- Select later -- ", "ANY" ); }

  // Set Filter from previous setting
  if(FilterPromo)
  {
    for(var j=0; j < i; j++)
    {
      if(document.all.sfAdList.options[j].value==FilterAdName)
      {
       document.all.sfAdList.selectedIndex=j;
       document.all.spfStatus.innerHTML="-- Now On --";
       document.all.dvFilterPromo.style.backgroundColor="LemonChiffon";
       break;
      }
    }
  }
}
//==============================================================================
// activate selected Filter
//==============================================================================
function activatePromoFilter()
{
   if(document.all.sfAdType.options[document.all.sfAdType.selectedIndex].value=="A")
   {
      FilterAdType = null;
      FilterAdTypeDes = null;
      FilterAdName = null;
      FilterPromo = false;
      document.all.spfStatus.innerHTML="";
      document.all.dvFilterPromo.style.backgroundColor="LightGrey";
   }
   else
   {
      FilterAdType = document.all.sfAdType.options[document.all.sfAdType.selectedIndex].value;
      FilterAdTypeDes = document.all.sfAdType.options[document.all.sfAdType.selectedIndex].text;
      FilterAdName = document.all.sfAdList.options[document.all.sfAdList.selectedIndex].value;
      FilterPromo = true;
      document.all.spfStatus.innerHTML="-- Now On --";
      document.all.dvFilterPromo.style.backgroundColor="LemonChiffon";
   }
}
//==============================================================================
// display Filter for media selection
//==============================================================================
function dspMediaFilter()
{
   var html = "<table>"
     + "<tr class='Filter1'><th colspan='2'>Media Filter&nbsp;&nbsp;&nbsp;&nbsp;"
     + "<span id='smfStatus' style='color:red; font-style: italic; '></span>"
     + "</th></tr>"
       + "<tr class='Filter'><td>Media:</td>"
       + "<td><select name='sfMedia' class='small'></select></td></tr>"
     + "<tr class='Filter'><td >&nbsp;</td>"
       + "<td><button id='btnSetMediaFilter' class='small' onclick='activateMediaFilter();'>Set</button></td></tr>"
     + "</table>"

   document.all.dvFilterMedia.innerHTML=html
   setMediaFilter();
   document.all.dvFilterMedia.style.pixelLeft=screen.width - document.all.dvFilterMedia.offsetWidth - 30
   document.all.dvFilterMedia.style.pixelTop=15
}

//==============================================================================
// Setup Media Filter dropdown menu
//==============================================================================
function setMediaFilter()
{
  document.all.sfMedia.options[0] = new Option("--Select Later--", "ANY");
  for (var i=0; i< Media.length; i++) { document.all.sfMedia.options[i+1] = new Option(MedName[i], i); }

  if(FilterMedia)
  {
    document.all.sfMedia.selectedIndex = eval(FilterMedIdx)+1;
    document.all.smfStatus.innerHTML="-- Now On --";
    document.all.dvFilterMedia.style.backgroundColor="LemonChiffon";
  }

}

//==============================================================================
// activate selected Filter
//==============================================================================
function activateMediaFilter()
{
   if(document.all.sfMedia.options[document.all.sfMedia.selectedIndex].value=="ANY")
   {
      FilterMedia = false;
      FilterMedCode = null;
      FilterMedName = null;
      FilterMedIdx = null;
      document.all.smfStatus.innerHTML="";
      document.all.dvFilterMedia.style.backgroundColor="LightGrey";
   }
   else
   {
      FilterMedIdx = document.all.sfMedia.options[document.all.sfMedia.selectedIndex].value;
      FilterMedCode = Media[FilterMedIdx]
      FilterMedName = MedName[FilterMedIdx];
      FilterMedia = true;
      document.all.smfStatus.innerHTML="-- Now On --";
      document.all.dvFilterMedia.style.backgroundColor="LemonChiffon";
   }
}

//==============================================================================
// Reset voth filters
//==============================================================================
function resetFilters()
{
   // reset media filter
   document.all.sfMedia.selectedIndex=0;
   activateMediaFilter();

   // reset promo filter
   document.all.sfAdType.selectedIndex=0;
   showFilterAdList();
   activatePromoFilter()
}

//==============================================================================
// Setup Ad type list
//==============================================================================
function setAdType()
{
  var i = 0;
  if(Promo.length > 0) document.all.AdType.options[i++] = new Option( "Promotion", "P");
  if(Event.length > 0) document.all.AdType.options[i++] = new Option( "Event", "E");
  if(NonEvt.length > 0) document.all.AdType.options[i++] = new Option("Non-Event", "N" );
  if(MedCom.length > 0) document.all.AdType.options[i++] = new Option("Media Commitments", "M" );
  document.all.AdType.options[i] = new Option( "None", "X");
  showAdList();
}

//==============================================================================
// Setup Adv List drop-menu
//==============================================================================
function showAdList()
{
  var adType = document.all.AdType[document.all.AdType.selectedIndex].value;
  var numOnList = document.all.AdList.length;

  for (var i = numOnList; i > 0; i--)  { document.all.AdList.options[i]=null; }

  if(adType=="P") { for (var i = 0; i < Promo.length; i++) { document.all.AdList.options[i] = new Option(Promo[i], Promo[i]); } }
  else if(adType=="E")  { for (var i = 0; i < Event.length; i++) { document.all.AdList.options[i] = new Option(Event[i], Event[i]); } }
  else if(adType=="N")  { for (var i = 0; i < NonEvt.length; i++) { document.all.AdList.options[i] = new Option(NonEvt[i], NonEvt[i]); } }
  else if(adType=="M")  { for (var i = 0; i < MedCom.length; i++) { document.all.AdList.options[i] = new Option(MedCom[i], MedCom[i]); } }
  else if(adType=="X")  { document.all.AdList.options[i] = new Option("None", "NONE" ); }
}

//==============================================================================
// Setup month drop-menu
//==============================================================================
function setMonth()
{
  var da = document.all;
  for (var i = 0; i < MonBegs.length; i++)
  {
    da.FiscMon.options[i] = new Option(MonName[i] + "  " + Year[i], MonBegs[i]);
  }
  da.FiscMon.selectedIndex = CurMon;
}

//------------------------------------------------------------------------------
// display Action Menu
//------------------------------------------------------------------------------
function dspActionMenu(obj, mkt, wk, media, adtype, adtypedes, adname, orgwk, seq, numwk, payee,
     size, wday, rate, sect, spot, comment, totplncost, totactcost, totfincost, frdate, todate, str,  exist)
{
   var curLeft = 0;
   var curTop = 0;
   var MenuName = "";
   var MenuOpt = "";

   var funcadd = null;
   var funcchg = null;
   var funcdlt = null;

   SelMkt = mkt;
   SelObj = obj;

   if (!exist)
   {
     SelWk = wk;
     funcadd = "dspMediaMenu(&#34;ADD&#34;)";
   }
   else
   {
     SelOrgWk = orgwk;
     SelAdType = adtype;
     SelAdTypeDes = adtypedes;
     SelAdName = adname;
     SelSeq = seq;
     SelPayee = payee;
     SelComment = comment;
     SelSize = size;
     SelWDay = wday;
     SelRate = rate;
     SelSect = sect;
     SelSpot = spot;
     SelFrDate = frdate;
     SelToDate = todate;
     SelStr = str;
     SelNumWk = numwk;
     SelTotPlnCost = totplncost;
     SelTotActCost = totactcost;
     SelTotFinCost = totfincost;
     SelMedia = getMediaArg(media);
     funcchg = "dspPromoEntry(&#34;CHG&#34;)";
     funcdlt = "sbmPromoEntry(&#34;DLT&#34;, null)";
     funcdltall = "sbmPromoEntry(&#34;DLT&#34;, &#34;ALL&#34;)";
   }

   // menu panel name
   MenuName = "<td class='Menu1' nowrap>" + MktName[mkt].substring(0, 3) + ", " + Wkend[wk] + "</td>";

   // add option
   if (!exist) {
      MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
          + "onclick='" + funcadd + ";'>Add"
          + "</td></tr>";
   }
   if (exist) {
     // Change option
     MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='" + funcchg + ";'>Change"
       + "</td></tr>";

     // delte single record option
     MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='" + funcdlt + ";'>Delete"
       + "</td></tr>";

     // delte all similar record option
     MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='" + funcdltall + ";'>Delete everywhere"
       + "</td></tr>";

   }

   // add close option on menu
   MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='hideMenu();'>Close"
       + "</td></tr>";

   var MenuHtml = "<table width='100%' cellPadding='0' cellSpacing='0'>"
   + "<tr>"
     + MenuName
     + "<td class='Menu2' valign=top>"
     +  "<img src='CloseButton.bmp' onclick='javascript:hideMenu();' alt='Close'>"
     + "</td>"
   + "</tr>"
   + MenuOpt
   + "</table>"

   // position menu on the screen
   if (obj.offsetParent)
   {
     while (obj.offsetParent)
     {
       curLeft += obj.offsetLeft
       curTop += obj.offsetTop
       obj = obj.offsetParent;
     }
   }
   else if (obj.x)
   {
     curLeft += obj.x;
     curTop += obj.y;
   }

   if (curTop > (document.body.scrollTop + screen.height - 250))
   {
      curTop = document.body.scrollTop + screen.height - 300;
   }
      curLeft += 70;
   if (curLeft > (document.body.scrollLeft + screen.width - 200))
   {
      curLeft = document.body.scrollLeft + screen.width - 200;
   }

   document.all.menu.innerHTML=MenuHtml
   document.all.menu.style.pixelLeft=curLeft
   document.all.menu.style.pixelTop=curTop
   document.all.menu.style.visibility="visible"
}

//------------------------------------------------------------------------------
// add Promotion for All Markets
//------------------------------------------------------------------------------
function addAllMktEvt(wk, obj)
{
  SelLevel = "ALL";
  SelObj = obj;

  if (wk == null) { SelWk = 0; SelMonWk = true; }
  else { SelWk = wk; SelMonWk = false; }

  SelMkt = null;
  dspMediaMenu('ADD');
}


//------------------------------------------------------------------------------
// display Argument of Media from Media Array
//------------------------------------------------------------------------------
function getMediaArg(medCode)
{
   var i=0;
   for(; i<Media.length;i++)
   {
      if(Media[i]==medCode)
      {
        break;
      }
   }
   return i;
}


//------------------------------------------------------------------------------
// display Media Menu
//------------------------------------------------------------------------------
function dspMediaMenu(action)
{
   var curLeft = 0;
   var curTop = 0;
   var MenuName = "";
   var MenuOpt = "";
   var obj = SelObj;
   SelAction = action;

   // Skip Promotion selection when filter is on
   if (FilterMedia) { dspPromoMenu(FilterMedIdx,'ADD'); return; }

   if (SelLevel != "ALL")
       MenuName = "<td class='Menu1' nowrap>" + MktName[SelMkt].substring(0, 3) + ", " + Wkend[SelWk] + "</td>";
   else
       MenuName = "<td class='Menu1' nowrap>ALL, " + Wkend[SelWk] + "</td>";


   // populate media in menu
   for (var i=0; i< Media.length; i++)
   {
     MenuOpt += "<tr><td class='Menu' colspan='2'"
       + " onclick='dspPromoMenu(" + i + ",&#34;" + action + "&#34;)' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' nowrap>"
       + MedName[i] + "</td></tr>";
   }

   // add close option on menu
   MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='hideMenu();'>Close"
       + "</td></tr>";

   var MenuHtml = "<table width='100%' cellPadding='0' cellSpacing='0'>"
   + "<tr>"
     + MenuName
     + "<td class='Menu2' valign=top>"
     +  "<img src='CloseButton.bmp' onclick='javascript:hideMenu();' alt='Close'>"
     + "</td>"
   + "</tr>"
   + MenuOpt
   + "</table>"


   document.all.menu.innerHTML=MenuHtml
   document.all.menu.style.pixelLeft = document.body.scrollLeft + 20;
   document.all.menu.style.pixelTop = document.body.scrollTop + 120
   document.all.menu.style.visibility="visible"
}

//------------------------------------------------------------------------------
// display Media Menu
//------------------------------------------------------------------------------
function dspPromoMenu(med, action)
{
   var curLeft = 0;
   var curTop = 0;
   var MenuName = "";
   var MenuOpt = "";
   var obj = SelObj;

   SelMedia = med;

   // Skip Promotion selection when filter is on
   if (FilterPromo) { dspPromoEntry('ADD'); return; }

   if (SelLevel != "ALL")
      MenuName = "<td class='Menu1' nowrap>" + MktName[SelMkt].substring(0, 3) + ", " + Wkend[SelWk] + "</td>";
   else
      MenuName = "<td class='Menu1' nowrap>ALL, " + Wkend[SelWk] + "</td>";


   MenuOpt += "<tr><td class='Menu' colspan='2' nowrap>"
            + "Promotion Type:<select name='AdType' class='small' onchange='showAdList()'></select>"
            + "</td></tr>";
   MenuOpt += "<tr><td class='Menu' colspan='2' nowrap>"
            + "Promotion Type:<select name='AdList' class='small'></select>"
            + "</td></tr>";


   // add continue option on menu
   MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='dspPromoEntry(&#34;" + action + "&#34;); hideMenu();'>Continue"
       + "</td></tr>";

   // add close option on menu
   MenuOpt += "<tr><td colspan='2' class='Menu' onmouseOver='hilightOption(this, true)' onmouseOut='hilightOption(this, false)' align='center' "
       + "onclick='hideMenu();'>Close"
       + "</td></tr>";

   var MenuHtml = "<table width='100%' cellPadding='0' cellSpacing='0'>"
   + "<tr>"
     + MenuName
     + "<td class='Menu2' valign=top>"
     +  "<img src='CloseButton.bmp' onclick='javascript:hideMenu();' alt='Close'>"
     + "</td>"
   + "</tr>"
   + MenuOpt
   + "</table>"


   document.all.menu.innerHTML=MenuHtml
   document.all.menu.style.pixelLeft= document.body.scrollLeft + 20
   document.all.menu.style.pixelTop= document.body.scrollTop + 120
   document.all.menu.style.visibility="visible"
   setAdType();
}

//------------------------------------------------------------------------------
// Hilight menu options, when mouse moves over it.
//------------------------------------------------------------------------------
function hilightOption(obj, over)
{
  if(over)
  {
    obj.style.color = "darkred";
    obj.style.textDecoration="underline"
    obj.style.backgroundColor = "white";
  }
  else
  {
    obj.style.color = "black";
    obj.style.textDecoration="none"
    obj.style.backgroundColor = "#EEEEEE";
  }
}


//========================================================================
// display Promotion entry
//========================================================================
function dspPromoEntry(action)
{
  var MenuName = "";
  var MenuOpt = "";
  var week = null;

  // save ad type and name entry
  if(action=="ADD")
  {
    if (FilterPromo)
    {
       SelAdType = FilterAdType;
       SelAdTypeDes = FilterAdTypeDes;
       SelAdName = FilterAdName;
    }
    else
    {
       SelAdType = document.all.AdType.options[document.all.AdType.selectedIndex].value;
       SelAdTypeDes = document.all.AdType.options[document.all.AdType.selectedIndex].text;
       SelAdName = document.all.AdList.options[document.all.AdList.selectedIndex].value;
    }

    week = Wkend[SelWk];
  }
  else
  {
    week = SelOrgWk;
  }


  hideMenu();

  var  mkt = "";
  if(SelLevel != "ALL") mkt = MktName[SelMkt];
  else mkt = "ALL";

  MenuName = "<td colspan='10' nowrap>" + mkt + "&nbsp;&nbsp;&nbsp;" + week + "&nbsp;&nbsp;&nbsp;"
        + "Media: " + MedName[SelMedia] + "&nbsp;&nbsp;&nbsp;" + SelAdTypeDes + ": " + SelAdName + "</td>";




  // add Detail entry headings
  MenuOpt += "<tr>"
  if (SelMonWk)  MenuOpt += " <td class='Promo1' align='center' >No of<br>"
           + "<input type='radio' name='MonWk' checked value='M'>Month / "
           + "<input type='radio' name='MonWk' value='W'>Week</td>"

  else MenuOpt += " <td class='Promo1' align='center' >No of<br>Weeks</td>"
  MenuOpt += " <td class='Promo1' align='center' >Payee</td>"
         + "<td class='Promo1' align='center' >Date</td>"
         + "<td class='Promo1' align='center' >Day of Week</td>"
         + "<td class='Promo1' align='center' >Size of Ad or<br>Rows x Cols x Rate x/- Disc %/$</td>"

       + "</tr>";

  // add Detail entry fields
  MenuOpt += "<tr>"
         + "<td class='Promo1' align='center' ><input name='NumWk' class='Small' size=2 maxlength=2 value='1'></td>"
         + "<td class='Promo1' align='center' ><input name='Payee' class='Small' size=30 maxlength=30><br>"
         + "<select name='PayeeList' class='Small' onClick='getSelMedia(this)' disabled><option>Media List Loading Now</option></select></td>"
         + "<td class='Promo1' align='center' ><input name='FrDate' class='Small' size=10 maxlength=10 readonly>"
         + "<a href='javascript:showCalendar(1, null, null, 300, 450, document.all.FrDate)' >"
         + "<img src='calendar.gif' style='border=none' alt='Calendar Prompt' width='34' height='21'></a>"
         + "</td>"
         + "<td class='Promo1' align='center' >"
            + "<input name='WkDay' type='radio' value='1' checked>Mo &nbsp;"
            + "<input name='WkDay' type='radio' value='2'>Tu &nbsp;"
            + "<input name='WkDay' type='radio' value='3'>We &nbsp;"
            + "<input name='WkDay' type='radio' value='4'>Th &nbsp;"
            + "<input name='WkDay' type='radio' value='5'>Fr &nbsp;<br>"
            + "<input name='WkDay' type='radio' value='6'>Sa &nbsp;"
            + "<input name='WkDay' type='radio' value='0'>Su &nbsp;"
            + "<input name='WkDay' type='radio' value=' '>None &nbsp;"
         + "<input name='ToDate' type='hidden'>"
         + "</td>"
         + "<td class='Promo1' align='center' ><input name='AdSize' class='Small' size=30 maxlength=30><br>"
         + "<input name='AdRows' class='Small' size=3 maxlength=5> x <input name='AdCols' class='Small' size=3 maxlength=5>&nbsp;"
         + "x <input name='AdRate' class='Small' size=6 maxlength=10>"
         + "x <input name='AdDisc' class='Small' size=6 maxlength=10>"
         + "</td>"
         + "</tr>";

  // add Detail entry headings
  MenuOpt += "<tr>"
         + " <td class='Promo1' align='center' >Section</td>"
         + " <td class='Promo1' align='center' >Number of<br>Spots</td>"
         + " <td class='Promo1' align='center' >Planned<br>Cost</td>"
         + " <td class='Promo1' align='center' >Actual/<br>Approved Cost</td>"
         + " <td class='Promo1' align='center' >Comment</td>"
       + "</tr>";

  // add Detail entry fields
  MenuOpt += "<tr>"
         + "<td class='Promo1'><input name='Section' class='Small' size=30 maxlength=10></td>"
         + "<td class='Promo1'><input name='Spot' class='Small' size=10 maxlength=10></td>"
         + "<td class='Promo1'><input name='PlnCost' class='Small' size=9 maxlength=9></td>"
         + "<td class='Promo1'><input name='ActCost' class='Small' size=9 maxlength=9></td>"
         + " <td class='Promo1'><input name='Comment' class='Small' size=30 maxlength=50></td>"
       + "</tr>";

  // add market's store list
  if (SelLevel != "ALL")
  {
    MenuOpt += "<tr><td class='Promo1' colspan='5'>Charged Stores:&nbsp;&nbsp;&nbsp;"
    for(var i=0; i < Store[SelMkt].length; i++)
    {
       MenuOpt += "<input name='Store' type='checkbox' class='Small' value='" + Store[SelMkt][i] + "' checked >"
       + Store[SelMkt][i]
    }
  }
  else
  {
    MenuOpt += "<tr><td class='Promo1' colspan='5'>Charged Markets:&nbsp;&nbsp;&nbsp;"
    for(var i=0; i < Market.length; i++)
    {
       MenuOpt += "<input name='Store' type='checkbox' class='Small' value='" + Market[i] + "' checked >"
       + MktName[i] + "&nbsp;&nbsp;"
    }
    MenuOpt += "<button class='small' onclick='unCheckMarkets();'>Deselect</button>&nbsp;&nbsp;&nbsp;"
  }
  MenuOpt += "</td></tr>"

  // add close option on menu
  MenuOpt += "<tr><td colspan='10' class='Promo' align='center'>"
       + "<button class='small' onclick='validatePromoEntry(&#34;"+ action + "&#34;);'>Save</button>&nbsp;&nbsp;&nbsp;"
       + "<button class='small' onclick='resetPromoEntry();'>Reset</button>&nbsp;&nbsp;&nbsp;"
       + "<button class='small' onclick='hidePromoEntry();'>Close</button>&nbsp;&nbsp;&nbsp;"
       + "<button class='small' onclick='calcCost()'>Cost</button>&nbsp;&nbsp;&nbsp;"
       + "</td></tr>";

  var MenuHtml = "<table width='100%' cellPadding='0' cellSpacing='0'>"
  + "<tr class='Promo'>"
     + MenuName
     + "<td class='Menu2' valign=top>"
     +  "<img src='CloseButton.bmp' onclick='javascript:hidePromoEntry();' alt='Close'>"
     + "</td>"
   + "</tr>"
   + MenuOpt
   + "</table>"

  document.all.promo.innerHTML=MenuHtml
  document.all.promo.style.pixelLeft= (document.body.scrollLeft + screen.width - 900) / 2
  document.all.promo.style.pixelTop=document.body.scrollTop + screen.height - 500;
  document.all.promo.style.visibility="visible"

  if (SelLevel != "ALL" && Store[SelMkt].length == 1) document.all.Store.disabled=true;
  if(action=="CHG") popAdvFld();
  setMediaPrompt();
  allowFieldEntry();
}
//========================================================================
// populate Promo entry menu fields for changing existing events
//========================================================================
function popAdvFld()
{
   document.all.NumWk.value = SelNumWk;
   document.all.Payee.value = SelPayee;
   document.all.Comment.value = SelComment;
   document.all.AdSize.value = SelSize;
   document.all.AdRate.value = SelRate;
   // set week day
   if (SelWDay != null)
   {
     var weekDay  = document.all.WkDay;
     for(var i=0; i < weekDay.length; i++)
     {
        if (weekDay[i].value == SelWDay) weekDay[i].checked = true;
        else weekDay[i].checked = false;
     }
   }
   document.all.Section.value = SelSect;
   document.all.Spot.value = SelSpot;
   document.all.FrDate.value = SelFrDate;
   document.all.ToDate.value = SelToDate;
   document.all.PlnCost.value=SelTotPlnCost;
   document.all.ActCost.value=SelTotActCost;

   if (Store[SelMkt].length > 1)
   {
      for(var i=0; i < Store[SelMkt].length; i++)
      {
        document.all.Store[i].checked=false;
        for(var j=0; j < SelStr.length; j++)
        {
           if(SelStr[j]==Store[SelMkt][i])
           {
             document.all.Store[i].checked=true;
             break;
           }
        }
      }
   }
}

//========================================================================
// allow field entries
//========================================================================
function allowFieldEntry()
{
  if(Media[SelMedia] != "NP")
  {
     document.all.Section.disabled=true;
     document.all.Section.style.backgroundColor="lightgrey";
     document.all.AdSize.disabled=true;
     document.all.AdSize.style.backgroundColor="lightgrey";
     document.all.AdCols.disabled=true;
     document.all.AdCols.style.backgroundColor="lightgrey";
     document.all.AdRows.disabled=true;
     document.all.AdRows.style.backgroundColor="lightgrey";
     document.all.AdRate.disabled=true;
     document.all.AdRate.style.backgroundColor="lightgrey";
     document.all.WkDay.disabled=true;
     document.all.WkDay.style.backgroundColor="lightgrey";
  }
  if(Media[SelMedia] != "RA" && Media[SelMedia] != "TV"  )
  {
     document.all.Spot.disabled=true;
     document.all.Spot.style.backgroundColor="lightgrey";
  }
}
//========================================================================
// reset entries on Promo entry menu
//========================================================================
function resetPromoEntry()
{
  document.all.FrDate.value="";
  document.all.ToDate.value="";
  document.all.Payee.value="";
  document.all.Comment.value="";
  document.all.AdSize.value="";
  document.all.AdRows.value="";
  document.all.AdCols.value="";
  document.all.AdRate.value="";
  document.all.WkDay.value="";
  document.all.Section.value="";
  document.all.Spot.value="";
  document.all.PlnCost.value="";
  document.all.ActCost.value="";
}

//========================================================================
// calculate Cost od newspaper ad
//========================================================================
function calcCost()
{
  var cols =  eval(document.all.AdCols.value)
  var rows =  eval(document.all.AdRows.value)
  var rate =  eval(document.all.AdRate.value)
  var disc =  document.all.AdDisc.value.trim();
  var type = null;

  // check if discount m/b applied
  if(dic.trim()!="")
  {
    // check if discount in dollars
    if(disc.substring(0, 1) == "$") disc = eval(disc.substring(1))
    else if(disc.substring(disc.length-1) == "%") disc = eval(disc.substring(0,disc.length-1))
  }

  alert(disc)
  document.all.PlnCost.value = Math.round( (cols * rows * rate) * 100 ) / 100 ;
  if(document.all.AdSize.value.trim()=="") document.all.AdSize.value = cols + " x " + rows;
}
//========================================================================
// uncheck markets ckeckbox
//========================================================================
function unCheckMarkets()
{
   for(var i=0; i < Market.length; i++)
   {
      document.all.Store[i].checked = false;
   }
}

//========================================================================
// submit Promo entry
//========================================================================
function validatePromoEntry(action)
{
  var fnd = false;
  var error = false;
  var msg = "";

  // check if number of week is numeric
  if(isNaN(document.all.NumWk.value))
  {
    msg += "Number of week is not valid\n";
    error=true;
  }

  // validate that at least one store checked
  if(SelLevel != "ALL")
  {
     if(Store[SelMkt].length > 1)
     {
        for(var i=0; i < Store[SelMkt].length ; i++ ) { if (document.all.Store[i].checked==true) { fnd = true} }
        if (!fnd)
        {
           msg += "Please, check at least 1 store, that will be charged for the entered promotion.\n"
           error = true;
        }
     }
  }
  else
  {
     for(var i=0; i < Market.length ; i++ ) { if (document.all.Store[i].checked==true) { fnd = true} }
     if (!fnd)
     {
        msg += "Please, check at least 1 market, that will be charged for the entered promotion.\n"
        error = true;
     }
  }

  if (error) {  alert(msg) }
  else
  {
     sbmPromoEntry(action, null)
     hidePromoEntry();
  }
}
//========================================================================
// submit Promo entry
//========================================================================
function sbmPromoEntry(action, scope)
{
  hideMenu();
  var url = "AdCalEntry.jsp?"
    + "MonBeg=<%=sMonBeg%>"
    + "&MonName=<%=sMonName%>"
  if (SelLevel == "ALL" || scope != null) url += "&Market=ALL"
  else   url += "&Market=" + Market[SelMkt]

  var monwk = "W";

  if (SelMonWk && document.all.MonWk[0].checked == true) monwk = "M";

  url += "&Media=" + Media[SelMedia]
    + "&MedIdx=" + SelMedia
    + "&MedName=" + MedName[SelMedia]
    + "&AdType=" + SelAdType
    + "&AdTypeDes=" + SelAdTypeDes
    + "&AdName=" + SelAdName.trim()
    + "&Action=" + action

  var wday = rtvWeekDay();
  if (action=="ADD")
  {
      url += "&OrgWk=" + Wkend[SelWk]
           + "&Wkend=" + Wkend[SelWk]
           + "&NumWk=" + document.all.NumWk.value
           + "&MonWk=" + monwk
           + "&FrDate=" + document.all.FrDate.value
           + "&ToDate=" + document.all.ToDate.value
           + "&Payee=" + document.all.Payee.value
           + "&Comment=" + document.all.Payee.value
           + "&AdSize=" + document.all.AdSize.value
           + "&AdRate=" + document.all.AdRate.value
           + "&AdWDay=" + wday
           + "&Section=" + document.all.Section.value
           + "&Spot=" + document.all.Spot .value
           + "&PlnCost=" + document.all.PlnCost.value
           + "&ActCost=" + document.all.ActCost.value
    }
    else if (action=="CHG")
    {
      url += "&OrgWk=" + SelOrgWk
           + "&Seq=" + SelSeq
           + "&Wkend=" + SelOrgWk
           + "&NumWk=" + document.all.NumWk.value
           + "&FrDate=" + document.all.FrDate.value
           + "&ToDate=" + document.all.ToDate.value
           + "&Payee=" + document.all.Payee.value
           + "&Commnet=" + document.all.Payee.value
           + "&AdSize=" + document.all.AdSize.value
           + "&AdRate=" + document.all.AdRate.value
           + "&AdWDay=" + wday
           + "&Section=" + document.all.Section.value
           + "&Spot=" + document.all.Spot .value
           + "&PlnCost=" + document.all.PlnCost.value
           + "&ActCost=" + document.all.ActCost.value
    }
    else if (action=="DLT")
    {
      url += "&Seq=" + SelSeq
           + "&NumWk=" + SelNumWk
           + "&OrgWk=" + SelOrgWk
           + "&Wkend=" + SelOrgWk
    }

    if(FilterPromo) { url += "&FilterPromo=true" }
    if(FilterMedia) { url += "&FilterMedia=true" }

  if(SelLevel == null)
  {
     if( Store[SelMkt].length==1) { url += "&Store=" + Store[SelMkt][0] }
     else if(action!="DLT")
     {
       for(var i=0; i < Store[SelMkt].length ; i++ )
       {
          if (document.all.Store[i].checked==true) { url += "&Store=" + Store[SelMkt][i]; }
       }
     }
  }
  else
  {
     for(var i=0; i < Market.length ; i++ )
     {
        if (document.all.Store[i].checked==true)
        {
          url += "&Store=" + Market[i];
        }
     }
  }

  // alert(url)
  window.location.href=url;
}
//========================================================================
// retreive week day
//========================================================================
function rtvWeekDay()
{
   var weekDay  = document.all.WkDay;
   if (weekDay == null) return " ";
   for(var i=0; i < weekDay.length; i++)
   {
      if (weekDay[i].checked == true) return weekDay[i].value
   }
   return " ";
}
//========================================================================
// close dropdown menu
//========================================================================
function hideMenu(){  document.all.menu.style.visibility="hidden"}
//========================================================================
// close dropdown menu
//========================================================================
function hidePromoEntry()
{
  document.all.promo.style.visibility="hidden";
  SelLevel = null;
  SelMonWk = false;
}
//========================================================================
// Fold/Unfold Market detail line
//========================================================================
function dspMktLine(mkt)
{
  var line = 0;
  var row = "m" + mkt + "g" + (line++);

  while(document.all[row] != null)
  {
    if ( document.all[row].style.display=="none") { document.all[row].style.display="block"; }
    else {document.all[row].style.display="none";}
    // try next object
    row = "m" + mkt + "g" + (line++);
  }

}

//========================================================================
// Fold/Unfold Market detail (all) lines
//========================================================================
function dspMktDtl()
{
  for(var i = 0; i < Market.length; i++)
  {
    var g = 0;
    var row = "m" + i + "g" + (g++);
    while(document.all[row] != null)
    {
      if (!DtlMktLvl) { document.all[row].style.display="block"; }
      else {document.all[row].style.display="none";}
      // try next object
      row = "m" + i + "g" + (g++);
    }
  }
  DtlMktLvl = !DtlMktLvl;
}
//========================================================================
// Fold/Unfold All Group detail (all) lines
//========================================================================
function dspGrpDtl()
{
  for(var i = 0; i < Market.length; i++)
  {
    var g = 0;
    var grp = "m" + i + "g" + g;
    while(document.all[grp] != null)
    {
      var l = 0;
      var line = "m" + i + "g" + g + "l" + l;

      while(document.all[line] != null)
      {
        if (!DtlGrpLvl) { document.all[line].style.display="block"; }
        else {document.all[line].style.display="none";}

        l++;
        var line = "m" + i + "g" + g + "l" + l;
      }

      g++;
      grp = "m" + i + "g" + (g);
    }
  }

  DtlGrpLvl = !DtlGrpLvl;
}
//---------------------------------------------------------
// Go to Selected Month
//---------------------------------------------------------
function gotoSelMonth()
{
   var sel = document.all.FiscMon.selectedIndex;
   var uri = "AdCal.jsp?MonBeg=" + document.all.FiscMon.options[sel].value
           + "&MonName=" + document.all.FiscMon.options[sel].text
   //alert(uri)
   window.location.href = uri;
}

//-------------------------------------------------------------
// Prompt for Media populate media list
//-------------------------------------------------------------
function setMediaPrompt()
{
  var url = 'AdGetMktMedList.jsp?'
    + "&Market=" + Market[SelMkt]
    + "&Media=" + Media[SelMedia]

 //alert(url);
 //window.location.href = url;
 window.frame1.location = url;
}

//-------------------------------------------------------------
// Populate Media Prompt
//-------------------------------------------------------------
function popMediaPrompt(medList)
{
   var payee = document.all.PayeeList;
   if(medList.length > 0 )
   {
      for(var i=0; i < payee.length; i++ )
      {
        payee.options[i] = null;
      }
      for(var i=0; i < medList.length; i++ )
      {
         payee.options[i] = new Option(medList[i], medList[i]);
      }
      payee.disabled=false;
   }
   else
   {
      payee.options[0] = new Option("-- No media found --", "NONE");
   }
}
//-------------------------------------------------------------
// get Selected Media and populate Payy field
//-------------------------------------------------------------
function getSelMedia(med)
{
   document.all.Payee.value = med.options[med.selectedIndex].value;
}
//---------------------------------------------------------
// launch calculator
//---------------------------------------------------------
function launchCalc()
{
  var url = "calc.html"
  var WindowName = 'Calculator';
  var WindowOptions =
   'width=150,height=150, left=100,top=50, resizable=yes , toolbar=no, location=no, directories=no, status=yes, scrollbars=no,menubar=no';

  //alert(url)
  window.open(url, WindowName, WindowOptions);
}

//---------------------------------------------------------
// launch fiscal Calendar
//---------------------------------------------------------
function launchFisCal()
{
  var url = "FisCal.jsp"
  var WindowName = 'FiscalCalendar';
  var WindowOptions =
   'width=150,height=150, left=100,top=50, resizable=yes , toolbar=no, location=no, directories=no, status=yes, scrollbars=no,menubar=no';

  //alert(url)
  window.open(url, WindowName, WindowOptions);
}
//---------------------------------------------------------
//create String method Trim
//---------------------------------------------------------
function String.prototype.trim()
{ //trim leading and trailing spaces
    var s = this;
    var obj = /^(\s*)([\W\w]*)(\b\s*$)/;
    if (obj.test(s)) { s = s.replace(obj, '$2'); }
    var obj = /  /g;
    while (s.match(obj)) { s = s.replace(obj, " "); }
    return s;
}
</SCRIPT>
<script LANGUAGE="JavaScript1.2" src="Calendar.js"></script>

</head>
<!-------------------------------------------------------------------->
<body onload="bodyLoad();">
<!-------------------------------------------------------------------->
<iframe
  id="frame1"
  src=""
  frameborder=0 height="0" width="0">
</iframe>
<!-------------------------------------------------------------------->
  <div id="menu" class="Menu"></div>
  <div id="promo" class="Promo"></div>
<!-------------------------------------------------------------------->
  <table border="0" width="100%" height="100%" cellPadding="0" cellSpacing="0">
  <tr bgColor="moccasin">
      <!-------------------------------------------------------------------->
      <!-- Promotion Filter -->
      <!-------------------------------------------------------------------->
       <td ALIGN="left" VALIGN="TOP"><div id="dvFilterPromo" class="Filter"></div></td>
      <!-------------------------------------------------------------------->
      <!-- Month selector -->
      <!-------------------------------------------------------------------->
       <td ALIGN="center" VALIGN="TOP">
         <div id="dvMonth" class="Month">
             Month: <SELECT class="small" name="FiscMon"></SELECT><br>
             <button name="GoMonth" onClick="gotoSelMonth()" >Go</button>
         </div>
       </td>
      <!-------------------------------------------------------------------->
      <!-- Media Filter -->
      <!-------------------------------------------------------------------->
       <td ALIGN="right" VALIGN="TOP"><div id="dvFilterMedia" class="Filter"></div></td>
     <!-------------------------------------------------------------------->
     <!-- Headings -->
     <!-------------------------------------------------------------------->
     <tr bgColor="moccasin">

       <!-------------------------------------------------------------------->
       <!-- Calendar View -->
       <!-------------------------------------------------------------------->
       <td ALIGN="center" VALIGN="TOP">
         <div id="dvCalView" class="Month">Calendar View<br>
         <a href='javascript:showCalendar(1, null, null, 50, 155, null)' >Regular</a><br>
         <a href='javascript:launchFisCal()' >Fiscal</a>
         </div>
       </td>
       <!-------------------------------------------------------------------->
       <td ALIGN="center" VALIGN="TOP" >
         <b><font size="+2">Advertising Monthly Events</font>
         <br><a href="AdCal.jsp?MonBeg=<%=sPrvNxtMonth[0]%>&MonName=<%=sPrvNxtMonName[0]%>">
                   <IMG SRC="arrowLeft.gif" style="border=none" ALT="Previous Month"></a>
             &nbsp;&nbsp;&nbsp;
             <font size="+3"><%=sMonName%></font>
             &nbsp;&nbsp;&nbsp;
             <a href="AdCal.jsp?MonBeg=<%=sPrvNxtMonth[1]%>&MonName=<%=sPrvNxtMonName[1]%>">
                   <IMG SRC="arrowRight.gif" style="border=none" ALT="Next Month"></a></b>
       </td>
       <!-------------------------------------------------------------------->
       <!-- Ad Calendar -->
       <!-------------------------------------------------------------------->
       <td ALIGN="center" VALIGN="TOP">
         <div id="dvCalView" class="Month">Ad Calendar
         </div>
       </td>
     <!-------------------------------------------------------------------->
     </tr>
     <tr bgColor="moccasin">
       <td ALIGN="center" VALIGN="TOP" colspan="3"><br>
       <a href="../"><font color="red" size="-1">Home</font></a>&#62;
       <a href="../AdCalSel.jsp"><font color="red" size="-1">Month Selection</font></a>&#62;<font size="-1">This Page</font>
          &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
       <a href="javascript:resetFilters()"><font color="blue" size="-1">Reset both filters</font></a>
          &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
       <a href="AdPromoEntry.jsp" target="_blank"><font color="blue" size="-1">W/w Promotions</font></a>
         &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
       <a href="javascript: launchCalc();"><font color="blue" size="-1">Calculator</font></a>
    <!-------------------------------------------------------------------->
    <!--                     start of ad table  -->
    <!-------------------------------------------------------------------->
         <table class="DataTable" cellPadding="0" cellSpacing="0">
           <tr>
              <th class="DataTable" rowspan="2" colspan="2">
                  <a href="javascript:addAllMktEvt(null, this)">Market/Media</a><br>
                 <a href="javascript:dspMktDtl()">Fold/Unfold Group</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                 <a href="javascript:dspGrpDtl()">Fold/Unfold Details</a>
              </th>
              <th class="DataTable1" rowspan="3">&nbsp;</th>
              <%for(int i=0; i < iNumOfWk; i++){%>
                 <th class="DataTable" colspan="2">
                      <a href="javascript:addAllMktEvt(<%=i%>, this)">Week <%=i+1%></a></th>
                 <th class="DataTable1">&nbsp;</th>
              <%}%>
              <th class="DataTable" rowspan="3"  colspan="2">Advertising<br>Total</th>
              <th class="DataTable" rowspan="3"  colspan="2">Sales/Plan</th>
           </tr>
           <tr>
              <%for(int i=0; i < iNumOfWk; i++){%>
                <th class="DataTable" colspan="2"><%=sWkend[i]%></th>
                <th class="DataTable1" >&nbsp;</th>
              <%}%>
           </tr>
           <tr>
             <th class="DataTable2" colspan="2">Plan/Actual Sales <IMG SRC="ArrowRight01.gif" style="border=none"></th>
              <%for(int i=0; i < iNumOfWk; i++){%>
                <th class="DataTable" colspan="2">$<%=sWkPlan[i]%></th>
                <th class="DataTable1" >&nbsp;</th>
              <%}%>
           </tr>
          <!-- ------------------------------------------------------------- -->
          <!-- Market Totals -->
          <!-- ------------------------------------------------------------- -->
           <%for(int i=0; i < iNumOfMkt; i++){
              adCal.setMarketGroups(i);
              int iNumOfGrp = adCal.getNumOfGrp();
              String [] sMGGrp = adCal.getMGGrp();
              String [] sMGGrpName = adCal.getMGGrpName();
              String [][] sMGPlnCost = adCal.getMGPlnCost();
              String [][] sMGActCost = adCal.getMGActCost();
              String [][] sMGFinCost = adCal.getMGFinCost();
              String [][] sMGPlanPrc = adCal.getMGPlanPrc();
              String [][] sMGPlan = adCal.getMGPlan();

              String [] sMGTotPlnCost = adCal.getMGTotPlnCost();
              String [] sMGTotActCost = adCal.getMGTotActCost();
              String [] sMGTotFinCost = adCal.getMGTotFinCost();
              String [] sMGTotPlanPrc = adCal.getMGTotPlanPrc();
              String [] sMGTotPlan = adCal.getMGTotPlan();
              int [] iMGOrgArg = adCal.getMGOrgArg();
          %>
              <tr>
                <td class="DataTable"><%=sMktName[i]%></td>
                <td class="DataTable5"><%if(iNumOfGrp > 0) {%><a href="javascript:dspMktLine(<%=i%>)">Fold/Unfold</a><%} else {%>&nbsp;<%}%></td>
                <th class="DataTable1">&nbsp;</th>
                <%for(int j=0; j < iNumOfWk; j++){%>
                   <td class="DataTable4" onClick="dspActionMenu(this, <%=i%>, <%=j%>, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, false);">
                       <%if(!sMTPlnCost[i][j].equals("0")){%>$<%=sMTPlnCost[i][j]%><%} else {%>&nbsp;<%}%>
                   </td>
                   <td class="DataTable4" onClick="dspActionMenu(this, <%=i%>, <%=j%>, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, false);">
                       <%if(!sMTPlanPrc[i][j].equals(".0")){%><%=sMTPlanPrc[i][j]%>%<%} else {%>&nbsp;<%}%>
                   </td>
                   <th class="DataTable1">&nbsp;</th>
                <%}%>

                <td class="DataTable4" >
                       <%if(!sMTPlnCost[i][6].equals("0")){%>$<%=sMTPlnCost[i][6]%><%} else {%>&nbsp;<%}%>
                <td class="DataTable4" >
                       <%if(!sMTPlanPrc[i][6].equals(".0")){%><%=sMTPlanPrc[i][6]%>%<%} else {%>&nbsp;<%}%>
                <td class="DataTable4" >
                       <%if(!sMTPlan[i][6].equals("0")){%>$<%=sMTPlan[i][6]%><%} else {%>&nbsp;<%}%>
              </tr>

              <!-- --------------------------------------------------------- -->
              <!-- ---------------- Market Group -------------------------- -->
              <!-- --------------------------------------------------------- -->
              <%for(int j=0; j < iNumOfGrp; j++){

                  // get details for Market/Group
                  adCal.setMarketDetails(i, iMGOrgArg [j]);
                  int iNumOfLine = adCal.getNumOfMDMed();
                  String [] sMDMedia = adCal.getMDMedia();
                  String [] sMDMedName = adCal.getMDMedName();
                  String [] sMDPType = adCal.getMDPType();
                  String [] sMDPTypeDesc = adCal.getMDPTypeDesc();
                  String [] sMDPDesc = adCal.getMDPDesc();
                  String [] sMDOrgWk = adCal.getMDOrgWk();
                  String [] sMDSeq = adCal.getMDSeq();
                  String [] sMDPayee = adCal.getMDPayee();
                  String [] sMDSize = adCal.getMDSize();
                  String [] sMDWDay = adCal.getMDWDay();
                  String [] sMDRate = adCal.getMDRate();
                  String [] sMDSect = adCal.getMDSect();
                  String [] sMDSpot = adCal.getMDSpot();
                  String [] sMDComt = adCal.getMDComt();
                  String [] sMDFrDate = adCal.getMDFrDate();
                  String [] sMDToDate = adCal.getMDToDate();
                  String [] sMDStr = adCal.getMDStr();
                  String [] sMDTotPlnCost = adCal.getMDTotPlnCost();
                  String [] sMDTotActCost = adCal.getMDTotActCost();
                  String [] sMDTotFinCost = adCal.getMDTotFinCost();
                  String [] sMDNumWk = adCal.getMDNumWk();
                  String [][] sMDPlnCost = adCal.getMDPlnCost();
                  String [][] sMDActCost = adCal.getMDActCost();
                  String [][] sMDFinCost = adCal.getMDFinCost();
                  String [][] sMDPlanPrc = adCal.getMDPlanPrc();

                  //  line total
                  String [] sLTPlnCost = adCal.getLTPlnCost();
                  String [] sLTActCost = adCal.getLTActCost();
                  String [] sLTFinCost = adCal.getLTFinCost();
                  String [] sLTPlanPrc = adCal.getLTPlanPrc();
              %>

                <tr id="m<%=i%>g<%=j%>" >
                   <td class="DataTable2" colspan="2"><%=sMGGrpName[j]%></td>
                   <th class="DataTable1">&nbsp;</th>
                   <%for(int k=0; k < iNumOfWk; k++){%>
                      <td class="DataTable2a">
                         <%if(!sMGPlnCost[j][k].equals("0")){%>$<%=sMGPlnCost[j][k]%><%} else {%>&nbsp;<%}%>
                      </td>
                      <td class="DataTable2a">
                         <%if(!sMGPlanPrc[j][k].equals(".0")){%><%=sMGPlanPrc[j][k]%>%<%} else {%>&nbsp;<%}%>
                      </td>
                      <th class="DataTable1">&nbsp;</th>
                   <%}%>
                   <td class="DataTable2a" >
                       <%if(!sMGTotPlnCost[j].equals("0")){%>$<%=sMGTotPlnCost[j]%><%} else {%>&nbsp;<%}%>
                   <td class="DataTable2a" >
                       <%if(!sMGTotPlanPrc[j].equals(".0")){%><%=sMGTotPlanPrc[j]%>%<%} else {%>&nbsp;<%}%>
                   <td class="DataTable2a" >&nbsp;
                </tr>
                <!-- --------------------------------------------------------- -->
                <!-- ---------------- Market Details -------------------------- -->
                <!-- --------------------------------------------------------- -->
                <%for(int k=0; k < iNumOfLine; k++){%>
                   <tr id="m<%=i%>g<%=j%>l<%=k%>">
                   <td class="DataTable3a" colspan="2"
                      onClick="dspActionMenu(this, <%=i%>, null, '<%=sMDMedia[k]%>', '<%=sMDPType[k]%>', '<%=sMDPTypeDesc[k]%>',
                       '<%=sMDPDesc[k]%>', '<%=sMDOrgWk[k]%>', '<%=sMDSeq[k]%>', '<%=sMDNumWk[k]%>',
                       '<%=sMDPayee[k]%>', '<%=sMDSize[k]%>', '<%=sMDWDay[k]%>', '<%=sMDRate[k]%>', '<%=sMDSect[k]%>', '<%=sMDSpot[k]%>','<%=sMDComt[k]%>',
                       '<%=sMDTotPlnCost[k]%>', '<%=sMDTotActCost[k]%>', '<%=sMDTotFinCost[k]%>',
                       '<%=sMDFrDate[k]%>', '<%=sMDToDate[k]%>', [<%=sMDStr[k]%>],true);">
                       <%=sMDPayee[k]%> / <%=sMDPDesc[k]%>
                   </td>

                   <th class="DataTable1">&nbsp;</th>
                   <%for(int l=0; l < iNumOfWk; l++){%>
                       <%if(!sMDPlnCost[k][l].equals(".00")) {%>
                          <td class="DataTable3"><%if(!sMDPlnCost[k][l].equals("0")){%>$<%=sMDPlnCost[k][l]%><%} else {%>&nbsp;<%}%></td>
                          <td class="DataTable3"><%if(!sMDPlnCost[k][l].equals("0")){%><%=sMDPlanPrc[k][l]%>%<%} else {%>&nbsp;<%}%></td>
                       <%}
                         else {%>
                            <td class="DataTable3" >&nbsp;</td>
                            <td class="DataTable3" >&nbsp;</td>
                       <%}%>
                       <th class="DataTable1">&nbsp;</th>
                   <%}%>

                    <%if(!sLTPlnCost[k].equals(".00")) {%>
                        <td class="DataTable3">$<%=sLTPlnCost[k]%></td>
                        <td class="DataTable3"><%=sLTPlanPrc[k]%>%</td>
                   <%}
                     else {%>
                        <td class="DataTable3" >&nbsp;</td>
                       <%}%>
                     <td class="DataTable3" >&nbsp;</td>
                   </tr>

                <%}%>
              <%}%>
           <%}%>
           <!-- ----------------------- Report total ----------------------- -->
           <tr>
              <td class="DataTable" colspan="2">Total</td>
              <th class="DataTable1">&nbsp;</th>
                  <%for(int i=0; i < iNumOfWk; i++){%>
                     <td class="DataTable4">
                         <%if(!sRTPlnCost[i].equals("0")){%>$<%=sRTPlnCost[i]%><%} else {%>&nbsp;<%}%>
                     </td>
                     <td class="DataTable4">
                         <%if(!sRTPlanPrc[i].equals(".0")){%><%=sRTPlanPrc[i]%>%<%} else {%>&nbsp;<%}%>
                     </td>
                     <th class="DataTable1">&nbsp;</th>
                  <%}%>

              <td class="DataTable4" >
                 <%if(!sRTPlnCost[6].equals("0")){%>$<%=sRTPlnCost[6]%><%} else {%>&nbsp;<%}%>
              </td>
              <td class="DataTable4" >
                 <%if(!sRTPlanPrc[6].equals(".0")){%><%=sRTPlanPrc[6]%>%<%} else {%>&nbsp;<%}%>
              </td>
              <td class="DataTable4" >
                 <%if(!sRTPlan[6].equals("0")){%>$<%=sRTPlan[6]%><%} else {%>&nbsp;<%}%>
              </td>
           </tr>
<!-- --------------- End Store Weekly Events ---------------- -->
  </table>
<!------------- end of data table ------------------------>

 </td>
</tr>

</table>

</body>
</html>


<%
   adCal.disconnect();
 }
%>